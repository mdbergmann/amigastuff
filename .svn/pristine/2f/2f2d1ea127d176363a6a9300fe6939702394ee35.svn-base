@INCLUDE "Board.hws"
@INCLUDE "GomokuRules.hws"

Local Game = {}

Function Game:New(o)
    o = o Or {
        activeState = True,
        playerTurnNames = {[#PLAYER_WHITE] = "White's Turn", [#PLAYER_BLACK] = "Black's Turn"},
        playerWinStatus = {[#PLAYER_WHITE] = "White Wins!", [#PLAYER_BLACK] = "Black Wins!"},
        board = Board:New(),
        rules = Rules:New()
    }
    SetMetaTable(o, self)
    self.__index = self
    Return(o)
EndFunction

Function Game:Reset()
    activeState = True
    self.board = Board:New()
EndFunction

Function Game:WhooseTurn()
    Return(self.board:WhooseTurn())
EndFunction

Function Game:TakeTurn(col, row)
    Return(self.board:TakeTurn(col, row))
EndFunction

Function Game:IsActive()
    Return(self.activeState)
EndFunction

Function Game:SetActive(flag)
    self.activeState = flag
EndFunction

Function Game:GetPlayerStatus(player)
    Return(self.playerTurnNames[player])
EndFunction

Function Game:GetWinStatus(player)
    Return(self.playerWinStatus[player])
EndFunction

Function Game:GetGameStatusTextAndSetActiveState(playerOfLastTurn)
    Local nextPlayer = self:WhooseTurn()
    If playerOfLastTurn = Nil Then playerOfLastTurn = nextPlayer
    Local isWin = self.rules:IsWin(self.board, playerOfLastTurn)
    self:SetActive(Not isWin)
    If isWin = True
        Return(self:GetWinStatus(playerOfLastTurn))
    Else
        Return(self:GetPlayerStatus(nextPlayer))
    EndIf
EndFunction

